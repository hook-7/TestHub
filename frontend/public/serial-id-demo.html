<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸²å£IDå¤ç”¨æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #409eff;
        }
        .serial-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        .serial-item {
            padding: 8px 12px;
            background: #409eff;
            color: white;
            border-radius: 6px;
            font-weight: 500;
        }
        .serial-item.disconnected {
            background: #f56c6c;
            text-decoration: line-through;
        }
        button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        button:hover {
            background: #66b1ff;
        }
        button:disabled {
            background: #c0c4cc;
            cursor: not-allowed;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .highlight {
            color: #f39c12;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— ä¸²å£IDå¤ç”¨æœºåˆ¶æ¼”ç¤º</h1>
        
        <div class="demo-section">
            <h3>å½“å‰è¿æ¥çŠ¶æ€:</h3>
            <div class="serial-list" id="serialList"></div>
            <p><strong>ä¸‹ä¸€ä¸ªå¯ç”¨ID:</strong> <span id="nextId" class="highlight">1</span></p>
        </div>
        
        <div class="demo-section">
            <h3>æ“ä½œæ§åˆ¶:</h3>
            <button onclick="connectSerial()">è¿æ¥æ–°ä¸²å£</button>
            <button onclick="disconnectSerial(1)">æ–­å¼€ä¸²å£#1</button>
            <button onclick="disconnectSerial(2)">æ–­å¼€ä¸²å£#2</button>
            <button onclick="disconnectSerial(3)">æ–­å¼€ä¸²å£#3</button>
            <button onclick="disconnectAll()">æ–­å¼€æ‰€æœ‰</button>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        let connectedSerials = []
        let portCounter = 0
        
        function getNextSerialId() {
            const usedIds = connectedSerials.map(s => s.serial_id)
            // ä»1å¼€å§‹å¯»æ‰¾ç¬¬ä¸€ä¸ªæœªä½¿ç”¨çš„ID
            for (let id = 1; id <= usedIds.length + 1; id++) {
                if (!usedIds.includes(id)) {
                    return id
                }
            }
            return usedIds.length + 1
        }
        
        function updateDisplay() {
            // æ›´æ–°ä¸²å£åˆ—è¡¨æ˜¾ç¤º
            const serialList = document.getElementById('serialList')
            serialList.innerHTML = ''
            
            if (connectedSerials.length === 0) {
                serialList.innerHTML = '<span style="color: #666;">æš‚æ— è¿æ¥çš„ä¸²å£</span>'
            } else {
                connectedSerials.sort((a, b) => a.serial_id - b.serial_id).forEach(serial => {
                    const div = document.createElement('div')
                    div.className = 'serial-item'
                    div.textContent = `ä¸²å£#${serial.serial_id} (${serial.port})`
                    serialList.appendChild(div)
                })
            }
            
            // æ›´æ–°ä¸‹ä¸€ä¸ªå¯ç”¨ID
            document.getElementById('nextId').textContent = getNextSerialId()
        }
        
        function log(message) {
            const logElement = document.getElementById('log')
            const timestamp = new Date().toLocaleTimeString()
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`
            logElement.scrollTop = logElement.scrollHeight
        }
        
        function connectSerial() {
            const nextId = getNextSerialId()
            portCounter++
            const newSerial = {
                serial_id: nextId,
                port: `/dev/ttyUSB${portCounter}`
            }
            
            connectedSerials.push(newSerial)
            log(`<span class="highlight">è¿æ¥ä¸²å£:</span> åˆ†é…ID=${nextId}, ç«¯å£=${newSerial.port}`)
            updateDisplay()
        }
        
        function disconnectSerial(serialId) {
            const index = connectedSerials.findIndex(s => s.serial_id === serialId)
            if (index !== -1) {
                const serial = connectedSerials[index]
                connectedSerials.splice(index, 1)
                log(`<span class="highlight">æ–­å¼€ä¸²å£:</span> ID=${serialId}, ç«¯å£=${serial.port}`)
                updateDisplay()
            } else {
                log(`<span style="color: #f56c6c;">é”™è¯¯:</span> ä¸²å£#${serialId}ä¸å­˜åœ¨`)
            }
        }
        
        function disconnectAll() {
            if (connectedSerials.length > 0) {
                log(`<span class="highlight">æ–­å¼€æ‰€æœ‰ä¸²å£:</span> å…±${connectedSerials.length}ä¸ª`)
                connectedSerials = []
                updateDisplay()
            }
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = ''
        }
        
        // åˆå§‹åŒ–
        log('<span class="highlight">ä¸²å£IDå¤ç”¨æœºåˆ¶æ¼”ç¤ºå¯åŠ¨</span>')
        log('è§„åˆ™: IDä»1å¼€å§‹åˆ†é…ï¼Œæ–­å¼€åçš„IDä¼šè¢«æ–°è¿æ¥å¤ç”¨')
        log('æ“ä½œ: ç‚¹å‡»æŒ‰é’®æµ‹è¯•è¿æ¥å’Œæ–­å¼€æ“ä½œï¼Œè§‚å¯ŸIDåˆ†é…è§„å¾‹')
        log('=' * 60)
        updateDisplay()
    </script>
</body>
</html>